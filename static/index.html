<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Silent Disco - Real-time Audio Streaming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/css/style.css" />
  <script src="/static/livekit-client.min.js"></script>
  <!-- Web App Manifest (Android, Chrome, Edge) -->
  <link rel="manifest" href="/static/manifest.json">

  <!-- Theme color (Android Chrome, also used by manifest) -->
  <meta name="theme-color" content="#6366f1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1e1b4b">

  <!-- iOS Safari specific -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Silent Disco">
  <link rel="apple-touch-icon" href="/static/icon-192.png">

  <!-- Android Chrome specific (optional, manifest usually sufficient) -->
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Favicon (all platforms) -->
  <link rel="icon" type="image/png" sizes="32x32" href="/static/icon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/icon-16.png">

  <!-- Microsoft Tiles (Windows) -->
  <meta name="msapplication-TileColor" content="#6366f1">
  <meta name="msapplication-TileImage" content="/static/icon-192.png">

  <!-- General -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Silent Disco Audio Streaming - Share music and audio in real-time">
</head>
<body>
  <div class="scaffold">
    <header role="banner">
      <h1 class="brand">Silent <span class="accent">Disco</span></h1>
      <div class="pill" aria-label="Technical specifications">Opus ‚Ä¢ SFU ‚Ä¢ Low latency</div>
    </header>

    <main class="wrap" role="main">
      <!-- Landing -->
      <section id="landing" class="grid hidden" aria-label="Room selection">
        <div class="card rooms-card" style="grid-column: 1 / -1;">
          <h2 class="title-large">Join a Live Room</h2>
          <p class="subtitle">Tap any room to start listening</p>
          <div class="rooms" id="roomsList" role="list" aria-live="polite">
            <!-- Rooms will be populated here -->
          </div>
          <div id="emptyRooms" class="empty-state hidden" role="status">
            <svg class="empty-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M9 18V5l12-2v13M9 18l-7 2V8l7-2" />
              <circle cx="6" cy="16" r="2" />
              <circle cx="18" cy="14" r="2" />
            </svg>
            <h3>No rooms available yet</h3>
            <p>Be the first DJ and create a room below!</p>
          </div>
        </div>

        <div class="card create-room-card" style="grid-column: 1 / -1;">
          <details class="create-room-details">
            <summary class="btn secondary create-room-toggle" aria-label="Create a new DJ room">
              <span>+ Create DJ Room</span>
            </summary>
            <div class="create-room-content">
              <label for="roomNameInput" class="field-label">Room name</label>
              <div class="field">
                <input
                  id="roomNameInput"
                  class="input"
                  placeholder="e.g., Neon Groove, Chill Vibes"
                  aria-label="Enter room name"
                  aria-describedby="roomNameHelp"
                />
                <span id="roomNameHelp" class="help-text">Choose a catchy name for your DJ session</span>
                <button
                  id="btnCreate"
                  class="btn primary"
                  aria-label="Create room and start DJ session"
                >
                  Create Room
                </button>
              </div>
            </div>
          </details>
        </div>
      </section>

      <!-- DJ View -->
      <section id="djView" class="grid hidden" aria-label="DJ controls">
        <div class="card" style="grid-column: 1 / -1;">
          <div class="view-header">
            <div>
              <h2 class="room-title" id="djRoomTitle">Room</h2>
              <p class="section-title">You: <span id="djName"></span></p>
            </div>
            <button
              id="btnClose"
              class="btn danger"
              aria-label="Close this DJ room"
            >
              Close Room
            </button>
          </div>
        </div>

        <div class="card" style="grid-column: 1 / -1;">
          <h3 class="card-title">Audio Source</h3>
          <div class="row" style="gap:16px; align-items:flex-start;">
            <div class="source-controls" style="flex: 1 1 320px;">
              <div class="src-tabs" role="radiogroup" aria-label="Select audio source">
                <button
                  id="srcMic"
                  class="btn secondary"
                  role="radio"
                  aria-checked="false"
                  aria-label="Use microphone as audio source"
                >
                  <span class="btn-icon" aria-hidden="true">üé§</span>
                  Microphone
                </button>
                <div class="dropdown">
                  <button
                    id="srcExternal"
                    class="btn secondary"
                    role="radio"
                    aria-checked="false"
                    aria-haspopup="true"
                    aria-expanded="false"
                    aria-label="Use external audio device"
                  >
                    <span class="btn-icon" aria-hidden="true">üéµ</span>
                    External device
                    <span class="dropdown-arrow" aria-hidden="true">‚ñæ</span>
                  </button>
                  <div id="extDropdown" class="dropdown-content" role="menu"></div>
                </div>
                <button
                  id="srcSystem"
                  class="btn secondary"
                  role="radio"
                  aria-checked="false"
                  aria-label="Share system audio"
                >
                  <span class="btn-icon" aria-hidden="true">üíª</span>
                  System Audio
                </button>
                <button
                  id="btnMute"
                  class="btn stopped"
                  aria-label="Start broadcasting"
                  aria-pressed="false"
                >
                  <span class="broadcast-status" aria-hidden="true"></span>
                </button>
              </div>
            </div>

            <div style="flex: 1 1 280px;">
              <canvas
                id="djWave"
                height="60"
                aria-label="Audio waveform visualization"
                role="img"
              ></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Listener View -->
      <section id="listenerView" class="grid hidden" aria-label="Listener view">
        <div class="card" style="grid-column: 1 / -1;">
          <h2 class="room-title" id="lsRoomTitle">Room</h2>
          <div class="section-title">
            DJ: <span id="lsDj"></span> ‚Ä¢
            Listeners: <span id="lsCount" aria-live="polite">0</span>
          </div>
          <div id="offline" class="connection-status offline hidden" role="status" aria-live="polite">
            <span class="status-icon pulse" aria-hidden="true">‚óã</span>
            <span>DJ offline, waiting for stream‚Ä¶</span>
          </div>
          <div id="connected" class="connection-status connected hidden" role="status" aria-live="polite">
            <span class="status-icon" aria-hidden="true">‚óè</span>
            <span>Connected</span>
          </div>
        </div>
        <div class="card" style="grid-column: 1 / -1;">
          <canvas
            id="wave"
            height="80"
            aria-label="Audio waveform visualization"
            role="img"
          ></canvas>
          <audio
            id="listenerAudio"
            autoplay
            playsinline
            aria-label="Audio stream player"
          ></audio>
        </div>
      </section>

      <!-- Debug Log -->
      <section id="logCard" class="grid hidden" aria-label="Debug log">
        <div class="card log" style="grid-column: 1 / -1;">
          <h3 class="title">Log</h3>
          <pre
            id="log"
            role="log"
            aria-live="polite"
            aria-atomic="false"
            style="white-space:pre-wrap; font-size:12px; color:#b9b9c9; margin:0;"
          ></pre>
        </div>
      </section>
    </main>

    <footer role="contentinfo"></footer>
  </div>

  <script type="module" src="/static/js/app.js"></script>
</body>
</html>
